<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Results - R-QUEST Learning Platform</title>

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=MonteCarlo&display=swap" rel="stylesheet">
    <!-- jsPDF + html2canvas (via CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- QR generator (Qrious) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

    <style>
        :root {
            /* New Brown Earth Color Palette */
            --primary: #8B4513;
            /* Saddle Brown */
            --primary-light: #A0522D;
            /* Sienna */
            --primary-dark: #654321;
            /* Dark Brown */
            --secondary: #D2691E;
            /* Chocolate */
            --accent: #CD853F;
            /* Peru */
            --success: #228B22;
            /* Forest Green */
            --warning: #DAA520;
            /* Goldenrod */
            --danger: #B22222;
            /* Firebrick */
            --dark: #2C1810;
            /* Dark Brown */
            --darker: #1A0F0A;
            /* Very Dark Brown */
            --light: #FAF3E9;
            /* Light Beige */
            --lighter: #FFFDF9;
            /* Almost White */
            --gray: #8B7D6B;
            /* Gray-Brown */
            --gray-light: #E8E0D5;
            /* Light Brownish Gray */

            /* Theme Variables */
            --font-primary: 'Inter', sans-serif;
            --font-secondary: 'Merriweather', serif;
            --primary-gradient: linear-gradient(135deg, #8B4513 0%, #654321 100%);
            --accent-gradient: linear-gradient(135deg, #8B4513, #A0522D);
            --light-bg: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --card-bg-light: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
            --text-dark: #0f172a;
            --text-light: #f8fafc;
            --text-muted-light: #64748b;

            /* Radii, shadows and transitions */
            --radius-sm: 5px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-full: 9999px;

            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.10);
            --shadow-xl: 0 10px 30px rgba(0, 0, 0, 0.12);

            --transition-fast: 0.12s ease;
            --transition-normal: 0.25s ease;
            --transition-smooth: 0.35s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #F8F1E4 0%, #EFE5D3 100%);
            color: var(--dark);
            line-height: 1.45;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
            font-size: 15px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 14px;
        }

        /* ===== HEADER (Sama dengan index.html) ===== */
        .main-header {
            background: white;
            padding: 14px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--gray-light);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .logo-icon {
            width: 30px;
            height: 30px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 13px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .logo-text {
            font-weight: 700;
            font-size: 16px;
            color: var(--primary-dark);
            letter-spacing: -0.2px;
        }

        .tagline {
            font-size: 11px;
            color: var(--gray);
            margin-top: 1px;
        }

        /* Search Section */
        .search-section {
            background: transparent;
            margin: 28px auto 10px;
            padding: 5px 10px;
            border-radius: 0;
            box-shadow: none;
            max-width: 850px;
            position: relative;
            z-index: 0;
        }

        .search-header {
            text-align: center;
            margin-bottom: 10px;
        }

        .search-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--darker);
            margin-bottom: 5px;
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .search-subtitle {
            color: var(--gray);
            font-size: 0.85rem;
            line-height: 1.35;
            font-family: 'Inter', sans-serif;
        }

        .search-box {
            display: flex;
            gap: 8px;
            max-width: 650px;
            margin: 0 auto;
            flex-direction: column;
        }

        @media (min-width: 480px) {
            .search-box {
                flex-direction: row;
            }
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius-full);
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
            transition: var(--transition-normal);
            background: var(--lighter);
            min-width: 0;
        }

        .search-input:disabled {
            background-color: var(--gray-light);
            color: var(--gray);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .search-btn:disabled {
            background: linear-gradient(135deg, var(--gray) 0%, var(--gray-light) 100%);
            cursor: not-allowed;
            opacity: 0.7;
            transform: none !important;
            box-shadow: var(--shadow-sm) !important;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.15);
        }

        .search-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: 12px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: var(--shadow-md);
            white-space: nowrap;
            min-width: 110px;
            font-family: 'Inter', sans-serif;
        }

        .search-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary) 100%);
        }

        /* Results Container */
        .results-container {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .results-header {
            background: linear-gradient(135deg, var(--darker) 0%, #3A2618 100%);
            color: white;
            padding: 18px 14px;
            position: relative;
            overflow: hidden;
        }

        .results-header::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 70%);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .results-title {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 4px;
            position: relative;
            z-index: 2;
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .results-subtitle {
            font-size: 0.85rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
            line-height: 1.35;
            font-family: 'Inter', sans-serif;
        }

        /* Score Display */
        .score-display-section {
            padding: 18px 14px;
            display: grid;
            grid-template-columns: 1fr;
            gap: 18px;
        }

        @media (min-width: 768px) {
            .score-display-section {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                padding: 20px 18px;
            }
        }

        .profile-card {
            background: linear-gradient(135deg, #F9F5F0 0%, #F1EBE1 100%);
            border-radius: var(--radius-lg);
            padding: 18px;
            border: 1px solid var(--gray-light);
            box-shadow: var(--shadow-sm);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 14px;
        }

        .profile-avatar {
            width: 46px;
            height: 46px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            box-shadow: var(--shadow-md);
            flex-shrink: 0;
            font-family: 'Inter', sans-serif;
        }

        .profile-info {
            flex: 1;
            min-width: 0;
        }

        .profile-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 3px;
            line-height: 1.25;
            word-break: break-word;
            font-family: 'Inter', sans-serif;
        }

        .profile-username {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--gray);
            font-size: 0.8rem;
            font-family: 'Inter', sans-serif;
        }

        .rank-badge {
            background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%);
            color: white;
            padding: 5px 10px;
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 0.75rem;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            box-shadow: var(--shadow-sm);
            width: fit-content;
            font-family: 'Inter', sans-serif;
        }

        .score-card {
            background: linear-gradient(135deg, #FDF8F3 0%, #FAF1E6 100%);
            border-radius: var(--radius-lg);
            padding: 18px;
            border: 1px solid #E0C9B1;
            box-shadow: var(--shadow-sm);
            text-align: center;
        }

        .score-label {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.7px;
            font-family: 'Inter', sans-serif;
        }

        .score-value {
            font-size: 2.7rem;
            font-weight: 800;
            color: var(--primary-dark);
            margin: 10px 0;
            line-height: 1;
            position: relative;
            display: inline-block;
            font-family: 'Inter', sans-serif;
        }

        @media (min-width: 480px) {
            .score-value {
                font-size: 3rem;
            }
        }

        .score-value::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 70px;
            height: 2px;
            background: linear-gradient(90deg, transparent 0%, var(--primary) 50%, transparent 100%);
            border-radius: 1px;
        }

        .score-max {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 6px;
            font-family: 'Inter', sans-serif;
        }

        .score-progress {
            margin-top: 14px;
            height: 5px;
            background: var(--gray-light);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .score-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--success) 100%);
            border-radius: var(--radius-full);
            transition: width 1s ease;
        }

        /* Message Card */
        .message-card {
            background: linear-gradient(135deg, #FEF3E2 0%, #FDE8C8 100%);
            border-radius: var(--radius-lg);
            padding: 18px;
            border: 1px solid #F0C78A;
            margin: 0 14px 18px;
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
        }

        .message-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--warning) 0%, var(--accent) 100%);
        }

        .message-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--darker);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .message-content {
            color: #5D4037;
            font-size: 0.85rem;
            line-height: 1.45;
            font-family: 'Inter', sans-serif;
        }

        /* Certificate Section */
        .certificate-section {
            padding: 0 14px 18px;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .certificate-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 14px;
        }

        @media (min-width: 480px) {
            .certificate-options {
                grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
            }
        }

        .certificate-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 18px;
            border: 1px solid var(--gray-light);
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
            text-align: center;
        }

        .certificate-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .certificate-icon {
            width: 46px;
            height: 46px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 14px;
            color: white;
            font-size: 1.2rem;
        }

        .certificate-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 6px;
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .certificate-desc {
            color: var(--gray);
            font-size: 0.8rem;
            margin-bottom: 14px;
            line-height: 1.35;
            font-family: 'Inter', sans-serif;
        }

        .certificate-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            border-radius: var(--radius-full);
            padding: 8px 16px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            width: 100%;
            font-family: 'Inter', sans-serif;
        }

        .certificate-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Tabs Navigation */
        .tabs-container {
            padding: 0 14px 18px;
        }

        .tabs-navigation {
            display: flex;
            gap: 4px;
            background: var(--gray-light);
            padding: 3px;
            border-radius: var(--radius-full);
            margin-bottom: 18px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
            -webkit-overflow-scrolling: touch;
        }

        .tabs-navigation::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            flex: 0 0 auto;
            padding: 8px 12px;
            background: transparent;
            border: none;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition-normal);
            white-space: nowrap;
            min-width: 90px;
            text-align: center;
            font-family: 'Inter', sans-serif;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.5);
            color: var(--dark);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            margin-bottom: 18px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 650px;
            font-size: 0.8rem;
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: white;
        }

        .data-table th {
            padding: 12px 10px;
            text-align: left;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-family: 'Inter', sans-serif;
        }

        .data-table tbody tr {
            border-bottom: 1px solid var(--gray-light);
            transition: var(--transition-fast);
        }

        .data-table tbody tr:hover {
            background: #f8fafc;
        }

        .data-table td {
            padding: 12px 10px;
            color: var(--dark);
            font-size: 0.8rem;
            font-family: 'Inter', sans-serif;
        }

        .status-correct {
            color: #059669;
            font-weight: 600;
            background: #d1fae5;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            display: inline-block;
            font-size: 0.75rem;
            font-family: 'Inter', sans-serif;
        }

        .status-incorrect {
            color: #dc2626;
            font-weight: 600;
            background: #fee2e2;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            display: inline-block;
            font-size: 0.75rem;
            font-family: 'Inter', sans-serif;
        }

        .status-unanswered {
            color: var(--gray);
            font-weight: 600;
            background: #f3f4f6;
            padding: 3px 8px;
            border-radius: var(--radius-full);
            display: inline-block;
            font-size: 0.75rem;
            font-family: 'Inter', sans-serif;
        }

        /* Answers Section */
        .answers-list {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .answer-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 18px;
            border: 1px solid var(--gray-light);
            box-shadow: var(--shadow-sm);
            transition: var(--transition-normal);
        }

        .answer-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-light);
        }

        .answer-header {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-light);
        }

        @media (min-width: 480px) {
            .answer-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                gap: 12px;
            }
        }

        .answer-number {
            font-size: 0.95rem;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 6px;
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .answer-number::before {
            content: 'Q';
            background: var(--primary);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            flex-shrink: 0;
            font-family: 'Inter', sans-serif;
        }

        .answer-question {
            font-size: 0.9rem;
            color: var(--dark);
            margin-bottom: 14px;
            line-height: 1.45;
            text-align: justify;
            font-family: 'Inter', sans-serif;
        }

        .answer-details {
            display: grid;
            grid-template-columns: 1fr;
            gap: 14px;
            margin-bottom: 14px;
        }

        @media (min-width: 480px) {
            .answer-details {
                grid-template-columns: 1fr 1fr;
            }
        }

        .user-answer-box,
        .correct-answer-box {
            padding: 12px;
            border-radius: var(--radius-md);
            font-size: 0.85rem;
        }

        .user-answer-box {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
        }

        .correct-answer-box {
            background: #f0fdf4;
            border: 1px solid #bbf7d0;
        }

        .answer-box-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
            font-family: 'Inter', sans-serif;
        }

        .answer-box-content {
            font-size: 0.85rem;
            color: var(--dark);
            font-weight: 500;
            line-height: 1.35;
            word-break: break-word;
            font-family: 'Inter', sans-serif;
        }

        .explanation-box {
            background: #f8fafc;
            border-radius: var(--radius-md);
            padding: 14px;
            border-left: 4px solid var(--primary);
            font-size: 0.85rem;
        }

        .explanation-label {
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .explanation-content {
            color: var(--dark);
            line-height: 1.45;
            font-family: 'Inter', sans-serif;
            text-align: justify;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            padding: 18px 14px;
        }

        @media (min-width: 480px) {
            .action-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }

        .action-btn {
            flex: 1;
            min-width: 100%;
            padding: 14px 18px;
            border-radius: var(--radius-lg);
            border: none;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: var(--shadow-md);
            font-family: 'Inter', sans-serif;
        }

        @media (min-width: 480px) {
            .action-btn {
                min-width: 180px;
            }
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }

        .action-btn.secondary {
            background: white;
            color: var(--dark);
            border: 2px solid var(--gray-light);
        }

        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .action-btn.primary:hover {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
        }

        .action-btn.secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Info Cards */
        .info-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 18px;
            padding: 18px 0;
        }

        @media (min-width: 768px) {
            .info-cards {
                grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            }
        }

        .info-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 18px;
            border: 1px solid var(--gray-light);
            box-shadow: var(--shadow-md);
        }

        .info-card-title {
            font-size: 1.05rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .info-card-content {
            color: var(--gray);
            line-height: 1.45;
            font-size: 0.85rem;
            font-family: 'Inter', sans-serif;
        }

        /* Feedback Section */
        .feedback-section {
            background: white;
            border-radius: var(--radius-lg);
            padding: 22px;
            margin: 26px 0;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-light);
        }

        .feedback-section h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 14px;
            font-family: var(--font-primary);
        }

        .feedback-form {
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.85rem;
            font-family: 'Inter', sans-serif;
        }

        .form-control {
            padding: 10px 14px;
            border: 1px solid var(--gray-light);
            border-radius: 7px;
            font-size: 0.9rem;
            font-family: 'Inter', sans-serif;
            transition: var(--transition-normal);
            background: var(--lighter);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(139, 69, 19, 0.15);
        }

        .anonymous-option {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 6px;
        }

        .anonymous-option input {
            width: 15px;
            height: 15px;
            accent-color: var(--primary);
        }

        .anonymous-option label {
            font-size: 0.8rem;
            color: var(--gray);
            cursor: pointer;
        }

        textarea.form-control {
            min-height: 110px;
            resize: vertical;
        }

        /* ===== FOOTER (Sama dengan index.html) ===== */
        .main-footer {
            background: var(--darker);
            color: white;
            padding: 24px 0 16px;
            margin-top: 24px;
            font-size: 13px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .footer-section h3 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 16px;
            color: white;
            line-height: 1.3;
        }

        .footer-section p {
            color: #cbd5e1;
            margin-bottom: 16px;
            line-height: 1.5;
            font-size: 13px;
        }

        .social-links {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .social-link {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            transition: var(--transition-normal);
            text-decoration: none;
            flex-shrink: 0;
        }

        .social-link:hover {
            background: var(--primary);
            transform: translateY(-1px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            font-size: 10px;
            line-height: 1.6;
        }

        /* Certificate Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 14px;
            animation: fadeIn 0.3s ease;
            overflow-y: auto;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            padding: 18px;
            width: 100%;
            max-width: 480px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(16px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gray-light);
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark);
            line-height: 1.25;
            font-family: 'Inter', sans-serif;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.4rem;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition-fast);
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-family: 'Inter', sans-serif;
        }

        .close-btn:hover {
            background: var(--gray-light);
            color: var(--dark);
        }

        /* ===== LOCKED STATE MODAL ===== */
        .locked-modal {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(26, 15, 10, 0.97);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 16px;
            backdrop-filter: blur(4px);
            overflow-y: auto;
            /* Tambahkan scroll jika konten terlalu panjang */
        }

        .locked-modal-content {
            background: linear-gradient(135deg, #FFFDF9 0%, #FAF3E9 100%);
            border-radius: var(--radius-lg);
            padding: 20px;
            width: 100%;
            max-width: 420px;
            /* Kurangi max-width untuk mobile */
            max-height: 90vh;
            /* Batasi tinggi maksimum */
            overflow-y: auto;
            /* Tambahkan scroll internal jika perlu */
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--primary-light);
            text-align: center;
            position: relative;
            margin: auto;
            /* Center vertically */
        }

        .locked-modal-content::-webkit-scrollbar {
            width: 4px;
        }

        .locked-modal-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .locked-modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .locked-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            color: white;
            font-size: 28px;
            box-shadow: var(--shadow-lg);
        }

        .locked-title {
            font-size: 1.3rem;
            /* Ukuran lebih kecil untuk mobile */
            font-weight: 700;
            color: var(--darker);
            margin-bottom: 8px;
            font-family: 'Inter', sans-serif;
            line-height: 1.3;
        }

        .locked-subtitle {
            color: var(--gray);
            font-size: 0.85rem;
            /* Ukuran lebih kecil */
            margin-bottom: 20px;
            line-height: 1.4;
            font-family: 'Inter', sans-serif;
        }

        .timer-display {
            background: white;
            border-radius: var(--radius-md);
            padding: 16px;
            margin: 16px 0;
            border: 1px solid var(--gray-light);
            box-shadow: var(--shadow-sm);
        }

        .timer-label {
            font-size: 0.8rem;
            /* Ukuran lebih kecil */
            color: var(--gray);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
        }

        .timer-countdown {
            display: flex;
            justify-content: center;
            gap: 8px;
            /* Kurangi gap untuk mobile */
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        .timer-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 55px;
            /* Lebih kecil untuk mobile */
        }

        .timer-value {
            font-size: 1.8rem;
            /* Ukuran lebih kecil */
            font-weight: 800;
            color: var(--primary-dark);
            line-height: 1;
            font-family: 'Inter', sans-serif;
            min-height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-label-unit {
            font-size: 0.7rem;
            /* Ukuran lebih kecil */
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 4px;
            font-family: 'Inter', sans-serif;
        }

        .timer-separator {
            font-size: 1.5rem;
            /* Ukuran lebih kecil */
            color: var(--primary);
            font-weight: 700;
            display: flex;
            align-items: center;
            min-height: 42px;
        }

        .estimated-date {
            background: #FEF3E2;
            border-radius: var(--radius-md);
            padding: 12px;
            margin: 16px 0;
            border-left: 3px solid var(--warning);
            font-size: 0.85rem;
            /* Ukuran lebih kecil */
            text-align: left;
        }

        .estimated-date p {
            margin: 0;
            line-height: 1.4;
        }

        .estimated-date strong {
            color: var(--darker);
        }

        .results-unavailable-btn,
        .results-available-btn {
            border: none;
            border-radius: var(--radius-full);
            padding: 12px 20px;
            font-size: 0.9rem;
            /* Ukuran lebih kecil */
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-top: 16px;
            font-family: 'Inter', sans-serif;
            min-height: 44px;
            /* Tinggi minimum untuk touch */
        }

        .results-unavailable-btn {
            background: linear-gradient(135deg, var(--gray) 0%, var(--gray-light) 100%);
            color: white;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .results-available-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            cursor: pointer;
            box-shadow: var(--shadow-md);
            transition: var(--transition-normal);
        }

        .results-available-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
        }

        .locked-note {
            font-size: 0.7rem;
            /* Ukuran lebih kecil */
            color: var(--gray);
            margin-top: 12px;
            line-height: 1.3;
            font-family: 'Inter', sans-serif;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .locked-modal {
                padding: 12px;
                align-items: flex-start;
                /* Mulai dari atas untuk mobile */
                padding-top: 40px;
                /* Beri ruang di atas */
            }

            .locked-modal-content {
                padding: 16px;
                max-width: 100%;
                max-height: calc(100vh - 80px);
                /* Pastikan tidak melebihi viewport */
                margin: 0 auto;
            }

            .locked-title {
                font-size: 1.1rem;
            }

            .locked-subtitle {
                font-size: 0.8rem;
                margin-bottom: 16px;
            }

            .timer-unit {
                min-width: 45px;
                /* Lebih kecil untuk mobile kecil */
            }

            .timer-value {
                font-size: 1.5rem;
                min-height: 36px;
            }

            .timer-separator {
                font-size: 1.2rem;
                min-height: 36px;
            }

            .timer-label-unit {
                font-size: 0.65rem;
            }

            .results-unavailable-btn,
            .results-available-btn {
                font-size: 0.85rem;
                padding: 10px 16px;
                min-height: 40px;
            }
        }

        @media (min-width: 768px) {

            /* Desktop styles */
            .locked-modal-content {
                max-width: 480px;
                padding: 24px;
            }

            .locked-title {
                font-size: 1.5rem;
            }

            .locked-subtitle {
                font-size: 0.9rem;
            }

            .timer-unit {
                min-width: 70px;
            }

            .timer-value {
                font-size: 2.2rem;
            }

            .timer-separator {
                font-size: 1.8rem;
            }
        }

        /* Responsive Design - Mobile Optimizations */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
                /* Mobile base font size */
            }

            .container {
                padding: 0 12px;
            }

            .search-section {
                margin-top: 20px;
                max-width: 95%;
                padding: 12px;
            }

            .results-header {
                padding: 16px 12px;
            }

            .score-display-section {
                padding: 16px 12px;
                gap: 16px;
            }

            .profile-card,
            .score-card,
            .message-card,
            .certificate-card,
            .info-card,
            .answer-card {
                padding: 16px;
            }

            .certificate-section,
            .tabs-container,
            .action-buttons {
                padding: 0 12px 16px;
            }

            .message-card {
                margin: 0 12px 16px;
            }

            .feedback-section {
                padding: 18px;
                margin: 20px 0;
            }

            .footer-content {
                grid-template-columns: 1fr;
            }

            /* Font sizes untuk mobile */
            .search-title {
                font-size: 1.2rem;
            }

            .search-subtitle {
                font-size: 0.8rem;
            }

            .results-title {
                font-size: 1.25rem;
            }

            .section-title {
                font-size: 1.1rem;
            }

            .certificate-title {
                font-size: 1rem;
            }

            .answer-question,
            .explanation-content,
            .answer-box-content,
            .user-answer-box,
            .correct-answer-box {
                font-size: 14px;
                /* Target ukuran untuk mobile */
            }

            .answer-question {
                line-height: 1.4;
            }

            .explanation-content {
                line-height: 1.4;
            }
        }

        @media (max-width: 600px) {
            .certificate-options {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
                /* Pastikan base size 14px untuk mobile */
            }

            .container {
                padding: 0 10px;
            }

            .search-title {
                font-size: 1.15rem;
            }

            .score-value {
                font-size: 2.5rem;
            }

            .certificate-btn {
                padding: 7px 14px;
                font-size: 0.75rem;
            }

            .action-btn {
                padding: 12px 14px;
                font-size: 0.8rem;
            }

            /* Pastikan ukuran font 14px untuk konten utama di mobile */
            .answer-question {
                font-size: 14px;
                line-height: 1.4;
                margin-bottom: 12px;
            }

            .explanation-content {
                font-size: 14px;
                line-height: 1.4;
            }

            .answer-box-content {
                font-size: 14px;
                line-height: 1.35;
            }

            .user-answer-box,
            .correct-answer-box {
                font-size: 14px;
                padding: 10px;
            }

            .info-card-content {
                font-size: 14px;
                line-height: 1.4;
            }

            .message-content {
                font-size: 14px;
                line-height: 1.4;
            }
        }

        @media (min-width: 769px) {

            /* Desktop font sizes */
            .answer-question,
            .explanation-content,
            .answer-box-content,
            .user-answer-box,
            .correct-answer-box {
                font-size: 15px;
            }

            .answer-question {
                line-height: 1.45;
            }

            .explanation-content {
                line-height: 1.45;
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .text-primary {
            color: var(--primary);
        }

        .text-success {
            color: var(--success);
        }

        .text-warning {
            color: var(--warning);
        }

        .text-danger {
            color: var(--danger);
        }

        .text-gray {
            color: var(--gray);
        }

        .mb-14 {
            margin-bottom: 14px;
        }

        .mb-18 {
            margin-bottom: 18px;
        }

        .mt-14 {
            margin-top: 14px;
        }

        .mt-18 {
            margin-top: 18px;
        }

        .p-14 {
            padding: 14px;
        }

        .p-18 {
            padding: 18px;
        }

        .p-26 {
            padding: 26px;
        }

        #emptyState .p-30 {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 250px;
        }

        .mb-26 {
            margin-bottom: 26px;
        }

        .hidden {
            display: none;
        }

        .flex {
            display: flex;
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-6 {
            gap: 6px;
        }

        .gap-10 {
            gap: 10px;
        }

        .gap-14 {
            gap: 14px;
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 8px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Print styles */
        @media print {

            .main-header,
            .main-footer,
            .search-box .search-btn,
            .tabs-navigation,
            .action-buttons,
            .certificate-section,
            .feedback-section,
            #certificateModal,
            .certificate-card {
                display: none !important;
            }

            body,
            .container,
            .results-container,
            .results-header,
            .score-display-section,
            .answers-list,
            .data-table {
                background: white !important;
                color: #000 !important;
                box-shadow: none !important;
            }

            .info-card,
            .table-container {
                page-break-inside: avoid;
            }

            .container {
                max-width: 100% !important;
                padding: 0 6px !important;
            }

            * {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="main-header">
        <div class="container">
            <div class="header-content">
                <div class="logo-container">
                    <div class="logo-icon">RQ</div>
                    <div>
                        <div class="logo-text">R-QUEST</div>
                        <div class="tagline">Quiz Chronicles</div>
                    </div>
                </div>
                <!-- Logo Quiz di Kanan -->
                <div style="flex: 1; display: flex; justify-content: flex-end; align-items: center;">
                    <img src="https://res.cloudinary.com/dy6sxsb26/image/upload/v1767332925/QUIZ_CHRONICLES_sso5or.png"
                        alt="Quiz Chronicles Logo"
                        style="height: 40px; width: auto; max-width: 120px; object-fit: contain;">
                </div>
            </div>
        </div>
    </header>

    <!-- Search Section -->
    <section class="search-section">
        <div class="search-header">
            <h1 class="search-title">Quiz Results Dashboard</h1>
            <p class="search-subtitle">Enter your username to view detailed results and certificate</p>
        </div>
        <div class="search-box">
            <input type="text" class="search-input" id="usernameInput"
                placeholder="Enter your username (e.g., raffizahrandhika)">
            <button class="search-btn" id="searchBtn">
                <i class="fas fa-search"></i> View Results
            </button>
        </div>
    </section>

    <!-- Results Container -->
    <main class="container">
        <div class="results-container" id="resultsContainer" style="display: none;">
            <!-- Results Header -->
            <div class="results-header">
                <h2 class="results-title">Quiz Performance Report</h2>
                <p class="results-subtitle">Quiz Chronicles - The Unfolding Past</p>
            </div>

            <!-- Score Display -->
            <div class="score-display-section">
                <div class="profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profileAvatar">R</div>
                        <div class="profile-info">
                            <h3 class="profile-name" id="participantName">-</h3>
                            <div class="profile-username">
                                <i class="fas fa-user"></i>
                                <span id="participantUsername">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="rank-badge">
                        <i class="fas fa-trophy"></i>
                        Rank: <span id="participantRank">-</span> of <span id="totalParticipants">-</span>
                    </div>
                </div>

                <div class="score-card">
                    <div class="score-label">Total Score</div>
                    <div class="score-value" id="totalScore">-</div>
                    <div class="score-max">out of 1000 points</div>
                    <div class="score-progress">
                        <div class="score-progress-bar" id="scoreProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Message Card -->
            <div class="message-card">
                <h3 class="message-title">
                    <i class="fas fa-award"></i> Performance Analysis
                </h3>
                <p class="message-content" id="congratsMessage">
                    Enter your username to see personalized feedback and performance insights.
                </p>
            </div>

            <!-- Certificate Section -->
            <div class="certificate-section">
                <h3 class="section-title">
                    <i class="fas fa-certificate"></i> Achievement Certificate
                </h3>
                <div class="certificate-options">
                    <div class="certificate-card">
                        <div class="certificate-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <h4 class="certificate-title">Download Certificate</h4>
                        <p class="certificate-desc">Get your personalized achievement certificate in PNG format</p>
                        <button class="certificate-btn" id="downloadCertificateBtn">
                            <i class="fas fa-download"></i> Download PNG
                        </button>
                    </div>
                    <div class="certificate-card">
                        <div class="certificate-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <h4 class="certificate-title">Full Results PDF</h4>
                        <p class="certificate-desc">Download detailed results with explanations in PDF format</p>
                        <button class="certificate-btn" id="downloadResultsBtn">
                            <i class="fas fa-file-pdf"></i> Download PDF
                        </button>
                    </div>
                    <div class="certificate-card">
                        <div class="certificate-icon">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <h4 class="certificate-title">Share Results</h4>
                        <p class="certificate-desc">Share your achievement on social media platforms</p>
                        <button class="certificate-btn" id="shareResultsBtn">
                            <i class="fas fa-share"></i> Share Now
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tabs Navigation -->
            <div class="tabs-container">
                <div class="tabs-navigation">
                    <button class="tab-btn active" data-tab="answers">Your Answers</button>
                    <button class="tab-btn" data-tab="details">Score Details</button>
                    <button class="tab-btn" data-tab="weight">IRT Weighting</button>
                    <button class="tab-btn" data-tab="analysis">Performance Analysis</button>
                </div>

                <!-- Tab 1: Your Answers -->
                <div class="tab-content active" id="answers-tab">
                    <div class="answers-list" id="answersList">
                        <!-- Answers will be populated here -->
                    </div>
                </div>

                <!-- Tab 2: Score Details -->
                <div class="tab-content" id="details-tab">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Landmark</th>
                                    <th>Status</th>
                                    <th>Result</th>
                                    <th>Points Earned</th>
                                </tr>
                            </thead>
                            <tbody id="answerDetails">
                                <!-- Details will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab 3: IRT Weighting -->
                <div class="tab-content" id="weight-tab">
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Landmark</th>
                                    <th>A</th>
                                    <th>B</th>
                                    <th>C</th>
                                    <th>D</th>
                                    <th>Key</th>
                                    <th>Difficulty</th>
                                    <th>Initial Weight</th>
                                    <th>Final Weight</th>
                                </tr>
                            </thead>
                            <tbody id="weightTable">
                                <!-- Weight data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    <div class="info-cards">
                        <div class="info-card">
                            <h4 class="info-card-title">
                                <i class="fas fa-calculator"></i> About IRT Scoring
                            </h4>
                            <p class="info-card-content">
                                Item Response Theory (IRT) is an advanced scoring method that assigns different weights
                                to questions based on their difficulty level. Harder questions that fewer participants
                                answer correctly are worth more points, while easier questions are worth fewer points.
                            </p>
                        </div>
                        <div class="info-card">
                            <h4 class="info-card-title">
                                <i class="fas fa-chart-line"></i> Why IRT?
                            </h4>
                            <p class="info-card-content">
                                This method provides a more accurate assessment of your true ability level. It ensures
                                that participants who can solve challenging problems receive appropriate recognition,
                                making the scoring system fair and educationally meaningful.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Tab 4: Performance Analysis -->
                <div class="tab-content" id="analysis-tab">
                    <div class="info-cards">
                        <div class="info-card">
                            <h4 class="info-card-title">
                                <i class="fas fa-brain"></i> Cognitive Analysis
                            </h4>
                            <p class="info-card-content" id="cognitiveAnalysis">
                                Analysis will appear here after searching for a username.
                            </p>
                        </div>
                        <div class="info-card">
                            <h4 class="info-card-title">
                                <i class="fas fa-lightbulb"></i> Recommendations
                            </h4>
                            <p class="info-card-content" id="recommendations">
                                Personalized learning recommendations will appear here.
                            </p>
                        </div>
                        <div class="info-card">
                            <h4 class="info-card-title">
                                <i class="fas fa-trend-up"></i> Progress Tracking
                            </h4>
                            <p class="info-card-content" id="progressTracking">
                                Progress insights and comparison data will be shown here.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Empty State -->
        <div class="results-container" id="emptyState">
            <div class="results-header">
                <h2 class="results-title">Welcome to Quiz Results</h2>
                <p class="results-subtitle">Enter your username to begin</p>
            </div>
            <div class="p-30 text-center">
                <div class="certificate-icon" style="margin: 0 auto 20px;">
                    <i class="fas fa-search"></i>
                </div>
                <h3 class="section-title">No Results Yet</h3>
                <p class="text-gray mb-30">Enter your username in the search box above to view your quiz results,
                    certificate, and detailed performance analysis.</p>
                <button class="search-btn" onclick="document.getElementById('usernameInput').focus()"
                    style="max-width: 300px; margin-top: 10px;">
                    <i class="fas fa-search"></i> Search Username
                </button>
            </div>
        </div>

        <!-- Feedback Section (dipindah dari modal) -->
        <section class="feedback-section">
            <h3><i class="fas fa-comment-dots"></i> Berikan Feedback</h3>
            <form id="feedbackForm" class="feedback-form">
                <div class="form-group">
                    <label for="feedbackName">Nama Anda</label>
                    <input type="text" class="form-control" id="feedbackName" placeholder="Masukkan nama Anda">
                    <div class="anonymous-option">
                        <input type="checkbox" id="anonymousCheckbox">
                        <label for="anonymousCheckbox">Kirim sebagai <strong>Anonymous</strong>?</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="feedbackMessage">Pesan Feedback</label>
                    <textarea class="form-control" id="feedbackMessage" rows="5"
                        placeholder="Masukkan saran, komentar, atau laporkan masalah..."></textarea>
                </div>
                <button type="submit" class="search-btn">
                    <i class="fas fa-paper-plane"></i> Kirim Feedback
                </button>
            </form>
        </section>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>R-QUEST - Quiz Chronicles</h3>
                    <p>Quiz Chronicles The Unfolding Past adalah kuis yang menggabungkan pengetahuan sejarah dengan
                        tantangan interaktif dengan tujuan meningkatkan wawasan dan pemahaman.</p>
                    <div class="social-links">
                        <a href="https://youtube.com/@raffizahrandhika" class="social-link" title="YouTube">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="https://instagram.com/raffizahrandhika" class="social-link" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://t.me/raffizahrandhika" class="social-link" title="Telegram">
                            <i class="fab fa-telegram-plane"></i>
                        </a>
                        <a href="https://tiktok.com/@raffizahrandhika" class="social-link" title="TikTok">
                            <i class="fab fa-tiktok"></i>
                        </a>
                        <a href="https://x.com/mrffzd" class="social-link" title="Twitter">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="https://www.linkedin.com/in/muhammad-raffi-zahrandhika-7a6537378" class="social-link"
                            title="LinkedIn">
                            <i class="fab fa-linkedin-in"></i>
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4 style="margin-bottom: 10px;">Kontak</h4>
                    <p><i class="fas fa-envelope"></i> raffismartlab@gmail.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p> 2025 Muhammad Raffi Zahrandhika. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Locked State Modal -->
    <div class="locked-modal" id="lockedModal">
        <div class="locked-modal-content">
            <div class="locked-icon">
                <i class="fas fa-lock"></i>
            </div>

            <h2 class="locked-title">Hasil Kuis Sedang Diproses</h2>
            <p class="locked-subtitle">
                Tim penyelenggara masih merekap jawaban dari seluruh peserta.
                Hasil dan sertifikat akan tersedia setelah proses selesai.
            </p>

            <div class="timer-display">
                <div class="timer-label">Estimasi Waktu Tersisa</div>
                <div class="timer-countdown">
                    <div class="timer-unit">
                        <span class="timer-value" id="days">00</span>
                        <span class="timer-label-unit">Hari</span>
                    </div>
                    <div class="timer-separator">:</div>
                    <div class="timer-unit">
                        <span class="timer-value" id="hours">00</span>
                        <span class="timer-label-unit">Jam</span>
                    </div>
                    <div class="timer-separator">:</div>
                    <div class="timer-unit">
                        <span class="timer-value" id="minutes">00</span>
                        <span class="timer-label-unit">Menit</span>
                    </div>
                    <div class="timer-separator">:</div>
                    <div class="timer-unit">
                        <span class="timer-value" id="seconds">00</span>
                        <span class="timer-label-unit">Detik</span>
                    </div>
                </div>
            </div>

            <div class="estimated-date">
                <p><strong><i class="fas fa-calendar-alt"></i> Estimasi selesai:</strong> <br>28 Januari 2026, 16:30 WIB
                </p>
            </div>

            <button class="results-unavailable-btn" id="lockedBtn" disabled>
                <i class="fas fa-clock"></i> Hasil Akan Tersedia Setelah Timer
            </button>

            <button class="results-available-btn hidden" id="unlockedBtn">
                <i class="fas fa-check-circle"></i> LIHAT HASIL KUIS
            </button>

            <p class="locked-note">
                <i class="fas fa-info-circle"></i> Halaman ini akan otomatis menampilkan hasil kuis ketika timer
                mencapai 0.
                Anda juga dapat menekan tombol di atas untuk melihat hasil.
            </p>
        </div>
    </div>

    <!-- Certificate Modal -->
    <div class="modal" id="certificateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Certificate Preview</h3>
                <button class="close-btn" id="closeCertificateModal">&times;</button>
            </div>
            <div class="text-center">
                <canvas id="certificatePreview"
                    style="max-width: 100%; border-radius: var(--radius-md); margin: 20px 0; display: block;"></canvas>
                <div style="max-width: 520px; margin: 8px auto 0; text-align: left;">
                    <label for="certificateNameInput"
                        style="display:block; font-size:0.85rem; color:var(--gray); margin-bottom:6px;">Customize name
                        on certificate (optional)</label>
                    <input id="certificateNameInput" class="form-control" type="text"
                        placeholder="Enter name to appear on certificate"
                        style="width:100%; padding:10px 12px; border-radius:8px; border:1px solid var(--gray-light); font-family:Inter, sans-serif;">
                </div>
                <p class="text-gray" style="font-family: 'Inter', sans-serif; margin-top:10px;">Your certificate is
                    ready! Click download
                    to save it to your device.</p>
                <!--  Warning text  versi santai & jujur -->
                <div class="mt-16"
                    style="background: #FEF3E2; border-left: 4px solid var(--warning); padding: 14px 16px; border-radius: 0 var(--radius-md) var(--radius-md) 0; font-size: 0.75rem; line-height: 1.5; text-align: left;">
                    <strong> Heads up!</strong><br>
                    Ini sertifikat <em>purely for fun</em> <br>
                    <strong>Beneran cuma main-main.</strong> Jangan dipakai buat:
                    <ul style="margin: 8px 0 0 20px; padding-left: 5px;">
                        <li>ngisi portofolio resmi</li>
                        <li>posting LinkedIn trus caption "proud moment"</li>
                        <li>ngelamar kerja </li>
                    </ul>
                </div>
                <button class="search-btn" id="confirmDownloadBtn"
                    style="margin-top: 20px; margin-left: auto; margin-right: auto; display: block; width: fit-content; min-width: 200px;">
                    <i class="fas fa-download"></i> Download Certificate
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sample data structure  field `score` dan `rank` di participant dihapus
        const quizData = {
            questions: {
                "1": {
                    "materi": "Patung Liberty",
                    "question": "Patung Liberty terbuat dari lembaran tembaga setebal 3/32 inci dan awalnya berwarna cokelat kemerahan seperti tembaga baru. Kini, patung tersebut tampak berwarna hijau kebiruan yang khas. Apa penyebab utama perubahan warna tersebut?",
                    "prompt": "",
                    "correctAnswer": "B",
                    "options": {
                        "A": "Dicat hijau sejak awal untuk melambangkan harapan dan kebebasan yang abadi",
                        "B": "Tembaga mengalami oksidasi alami sehingga membentuk lapisan patina hijau",
                        "C": "Terkena hujan asam yang mengubah struktur kimia permukaan tembaga",
                        "D": "Sengaja diubah warnanya pada renovasi besar tahun 1986 untuk alasan estetika"
                    },
                    "explanation": "Warna hijau pada Patung Liberty adalah hasil dari proses oksidasi alami yang terjadi pada tembaga ketika terpapar udara dan kelembapan dalam jangka waktu lama. Proses ini disebut patinasi, yaitu tembaga bereaksi dengan oksigen, air, dan senyawa lain di atmosfer membentuk tembaga karbonat dan tembaga sulfat yang berwarna hijau kebiruan. Patung Liberty awalnya berwarna cokelat kemerahan seperti tembaga baru, tetapi secara bertahap warnanya berubah menjadi hijau seperti yang kita lihat sekarang. Yang menarik, lapisan patina hijau ini sebenarnya melindungi tembaga di bawahnya dari korosi lebih lanjut, sehingga patung dapat bertahan selama lebih dari 130 tahun."
                },
                "2": {
                    "materi": "Candi Borobudur",
                    "question": "Candi Borobudur yang dibangun pada masa Dinasti Syailendra mengalami 'rediscovery' pada masa kolonial Belanda. Siapa tokoh Inggris yang pertama kali menemukan kembali Candi Borobudur pada tahun 1814?",
                    "prompt": "",
                    "correctAnswer": "A",
                    "options": {
                        "A": "Thomas Stamford Raffles",
                        "B": "Herman Willem Daendels",
                        "C": "Colin Mackenzie",
                        "D": "John Crawford"
                    },
                    "explanation": "Candi Borobudur ditemukan kembali pada tahun 1814 oleh Thomas Stamford Raffles, Gubernur Jenderal Inggris di Jawa. Penemuan ini bermula dari laporan masyarakat lokal tentang adanya gundukan besar tertutup vegetasi di wilayah Magelang. Raffles mengutus H.C. Cornelius untuk menyelidiki dan membersihkan situs tersebut. Setelah dibersihkan, terungkaplah struktur candi Buddha terbesar di dunia yang terdiri dari sembilan teras dan ribuan relief yang menggambarkan ajaran Buddha. Penemuan ini menjadi titik awal restorasi dan pengakuan dunia terhadap keagungan arsitektur kuno Indonesia. Borobudur kini diakui sebagai Situs Warisan Dunia UNESCO sejak tahun 1991."
                },
                "3": {
                    "materi": "Taj Mahal",
                    "question": "Taj Mahal memiliki empat menara (minarets) di setiap sudutnya yang sengaja dibangun miring ke luar. Desain arsitektur Mughal ini juga terlihat di berbagai bangunan lain pada masa yang sama. Mengapa para arsitek sengaja membuat menara-menara tersebut miring ke luar?",
                    "prompt": "",
                    "correctAnswer": "C",
                    "options": {
                        "A": "Untuk menciptakan ilusi optik agar bangunan utama terlihat lebih besar",
                        "B": "Mengikuti tradisi arsitektur Persia yang dibawa oleh dinasti Mughal",
                        "C": "Agar jika terjadi gempa, menara akan roboh menjauhi bangunan utama",
                        "D": "Untuk memudahkan perawatan dan pembersihan bagian atas menara"
                    },
                    "explanation": "Menara-menara (minarets) Taj Mahal memang sengaja dibangun dengan kemiringan yang sangat halus ke arah luar, dan ini merupakan keputusan arsitektur yang sangat cerdik dengan tujuan keamanan struktural. Empat menara di sekitar kubah utama dirancang dengan sedikit kemiringan ke luar untuk melindungi makam utama jika terjadi keruntuhan akibat bencana seperti gempa bumi. Dengan desain ini, jika terjadi gempa bumi, menara-menara akan jatuh ke arah taman dan Sungai Yamuna (yang terletak di utara kompleks), dan bukan menimpa mausoleum. Kemiringan halus ini memastikan bahwa menara-menara akan jatuh menjauhi makam utama selama gempa bumi, sehingga melindungi struktur pusat."
                },
                "4": {
                    "materi": "Piramida Giza",
                    "question": "Piramida Agung memiliki saluran yang mengarah ke bintang Thuban dan konstelasi Orion. Apa fungsi spiritual dari saluran ini menurut kepercayaan Mesir kuno?",
                    "prompt": "",
                    "correctAnswer": "B",
                    "options": {
                        "A": "Menunjukkan kalender pertanian Mesir kuno",
                        "B": "Membuka jalan bagi roh firaun ke alam baka",
                        "C": "Menandai waktu pembangunan piramida",
                        "D": "Mengatur suhu dan sirkulasi udara dalam ruang pemakaman"
                    },
                    "explanation": `Saluran udara (air shafts) dalam Piramida Agung bukan sekadar sistem ventilasi biasa, melainkan memiliki fungsi spiritual yang mendalam dalam kepercayaan Mesir kuno.<br>
        <strong> Penyelarasan Astronomi</strong><ul style="margin-left: 10px; padding-left: 10px;"><li><strong>Saluran Utara:</strong> Mengarah ke bintang Thuban (Alpha Draconis) yang merupakan bintang kutub utara pada masa pembangunan piramida (sekitar 2500 SM)</li><li><strong>Saluran Selatan:</strong> Mengarah ke konstelasi Orion, khususnya bintang-bintang di Sabuk Orion</li></ul>
        <strong> Makna Spiritual</strong><br>Dalam kepercayaan Mesir kuno:<ul style="margin-left: 10px; padding-left: 10px;"><li>Orion dikaitkan dengan Osiris, dewa kematian dan alam baka</li><li>Bintang-bintang kutub dianggap sebagai tempat kekal di langit</li><li>Saluran ini dipercaya sebagai jalur bagi roh (Ka) firaun untuk melakukan perjalanan ke alam baka dan bergabung dengan dewa-dewa</li><li>Penyelarasan astronomi yang tepat menunjukkan bahwa saluran ini memiliki makna spiritual yang sangat penting dalam ritual pemakaman dan kepercayaan tentang kehidupan setelah kematian</li></ul>`
                },
                "5": {
                    "materi": "Menara Eiffel",
                    "question": "Menara Eiffel awalnya dirancang sebagai struktur sementara yang akan dibongkar setelah 20 tahun. Namun, munculnya teknologi radio pada awal abad ke-20 mengubah nasib menara ini. Mengapa Menara Eiffel menjadi sangat strategis bagi perkembangan komunikasi radio?",
                    "prompt": "",
                    "correctAnswer": "A",
                    "options": {
                        "A": "Ketinggian menara memberikan jangkauan sinyal radio yang optimal",
                        "B": "Lokasi geografis Paris berada di pusat benua Eropa",
                        "C": "Material besi pada struktur dapat memperkuat sinyal radio",
                        "D": "Fondasi kokoh mampu menopang peralatan transmisi berat"
                    },
                    "explanation": `Menara Eiffel, yang selesai dibangun pada tahun 1889, awalnya dirancang oleh Gustave Eiffel sebagai struktur sementara untuk memperingati 100 tahun Revolusi Prancis dalam Pameran Dunia (Exposition Universelle). Menara ini dirancang akan dibongkar setelah 20 tahun, yaitu sekitar tahun 1909. Namun, kemajuan teknologi radio mengubah nasibnya.
        <ul style="margin-left: 10px; padding-left: 10px;"><li><strong>Ketinggian menara (300 m)</strong> membuatnya ideal sebagai tempat transmisi sinyal radio yang dapat menjangkau wilayah yang luas</li><li><strong>Sejak tahun 1903,</strong> militer Prancis menggunakannya untuk eksperimen komunikasi radio jarak jauh</li><li><strong>Pada tahun 1906,</strong> dipasang antena permanen di puncaknya untuk keperluan transmisi radio</li><li><strong>Saat Perang Dunia I,</strong> menara ini memainkan peran penting dalam komunikasi militer Prancis</li></ul>`
                },
                "6": {
                    "materi": "Akropolis Athena",
                    "question": "Akropolis Athena dibangun di atas bukit dengan ketinggian 156 meter. Jika kita menganalisis alasan strategis dan simbolis pemilihan lokasi ini, mengapa posisi elevated (tinggi) menjadi faktor penting dalam konsep sacred space Yunani kuno?",
                    "prompt": "",
                    "correctAnswer": "D",
                    "options": {
                        "A": "Untuk menghindari banjir dan gempa bumi yang sering terjadi di dataran rendah",
                        "B": "Untuk memudahkan sistem pertahanan militer terhadap serangan musuh dari darat",
                        "C": "Untuk memanfaatkan angin pegunungan dalam ritual pembakaran dupa dan korban persembahan",
                        "D": "Untuk mendekati dunia para dewa dan menciptakan hierarki kosmis yang sakral"
                    },
                    "explanation": "Akropolis Athena yang dibangun di ketinggian 156 meter mencerminkan konsep sacred space dalam kosmologi Yunani kuno, yaitu hierarki vertikal antara dunia manusia dan dunia para dewa. Akropolis yang dibangun di atas bukit berbatu ini berfungsi sebagai pusat politik dan religius utama di Yunani kuno. Posisi yang elevated bukan sekadar untuk alasan praktis, tetapi untuk menciptakan ruang sakral yang secara simbolis lebih dekat dengan realm para dewa yang dipercaya tinggal di tempat tinggi seperti Gunung Olympus. Dengan demikian, posisi tinggi menciptakan hierarki kosmis yang sakral dan memungkinkan para penyembah merasa lebih dekat dengan dunia divine saat melakukan ritual keagamaan. Konsep ini kemudian menjadi model bagi pembangunan tempat suci lainnya di dunia Yunani kuno, di mana ketinggian selalu dikaitkan dengan kesucian dan kedekatan spiritual."
                },
                "7": {
                    "materi": "Ka'bah",
                    "question": "Kiswah Ka'bah berwarna hitam dengan bordir emas berisi kaligrafi ayat Al-Quran. Jika dilihat dari aspek psikologi warna, pemilihan warna hitam bertujuan untuk...",
                    "prompt": "",
                    "correctAnswer": "C",
                    "options": {
                        "A": "Menciptakan kontras maksimal dengan kaligrafi emas",
                        "B": "Menyerap panas matahari di iklim gurun yang ekstrem",
                        "C": "Memberikan kesan khidmat dan konsentrasi spiritual",
                        "D": "Menyerap radiasi panas dan melindungi struktur bangunan"
                    },
                    "explanation": "Kiswah Ka'bah yang berwarna hitam dengan kaligrafi emas memiliki makna psikologis yang mendalam, di mana warna hitam melambangkan kesucian, keagungan, kekuatan, dan kedalaman iman dalam Islam, sementara secara psikologis menciptakan kesan elegan, misterius, dan dramatis yang mendukung konsentrasi spiritual. Kombinasi dengan kaligrafi emas memberikan rasa optimisme dan inspirasi, sekaligus menunjukkan kemewahan spiritual dan keanggunan yang tidak mengganggu fokus ibadah. Dari segi psikologi warna, kombinasi hitam-emas pada Ka'bah secara efektif menciptakan atmosfer khidmat yang mengurangi distraksi visual, meningkatkan pemusatan perhatian, dan mendukung kontemplasi spiritual - menjadikan jawaban C (Memberikan kesan khidmat dan konsentrasi spiritual) sebagai pilihan yang paling tepat karena kedua warna tersebut bekerja sinergis untuk menciptakan suasana sakral yang kondusif bagi ibadah dan perenungan."
                },
                "8": {
                    "materi": "Great Wall of China",
                    "question": "Great Wall of China sering digambarkan sebagai \"naga raksasa yang menggeliat di pegunungan.\" Metafora ini menyiratkan makna mendalam tentang perannya bagi peradaban Tiongkok. Makna simbolis apakah yang paling tepat diwakili oleh metafora \"naga\" tersebut?",
                    "prompt": "",
                    "correctAnswer": "C",
                    "options": {
                        "A": "Kekuatan destruktif dan kehancuran yang ditimbulkan oleh perang",
                        "B": "Keindahan alam yang tidak tersentuh oleh campur tangan manusia",
                        "C": "Pelindung abadi dan simbol kekuatan serta ketahanan bangsa",
                        "D": "Ketergantungan Tiongkok pada kekuatan mistis untuk pertahanan"
                    },
                    "explanation": "Metafora \"naga raksasa yang menggeliat di pegunungan\" untuk Tembok Besar China memiliki makna simbolis yang kuat dalam budaya Tiongkok. Berbeda dengan mitologi Barat, naga dalam tradisi Tiongkok melambangkan kekuatan, kebijaksanaan, dan perlindungan.<br>Makna simbolis metafora naga untuk Tembok Besar:<ul style=\"margin-left: 10px; padding-left: 10px;\"><li>Pelindung abadi - menjaga peradaban dari ancaman luar</li><li>Kekuatan dan ketahanan - mencerminkan daya tahan ribuan tahun</li><li>Kontinuitas sejarah - menunjukkan adaptabilitas lintas dinasti</li><li>Identitas nasional - memperkuat kebanggaan Tiongkok</li></ul>Metafora ini menekankan aspek protektif dan simbolisme kekuatan nasional yang berkelanjutan, bukan destruksi, keindahan alam, atau ketergantungan mistis."
                },
                "9": {
                    "materi": "Burj Khalifa",
                    "question": "Burj Khalifa memiliki tinggi 828 meter dan terdiri dari 163 lantai. Gedung ini menggunakan desain yang menyempit ke atas dengan bentuk seperti bunga lily gurun. Mengapa desain yang menyempit ke atas ini dipilih untuk gedung super tinggi?",
                    "prompt": "",
                    "correctAnswer": "B",
                    "options": {
                        "A": "Untuk menghemat material konstruksi dan mengurangi biaya pembangunan",
                        "B": "Mengurangi beban angin dan meningkatkan stabilitas struktural",
                        "C": "Menciptakan tampilan yang lebih artistik dan menarik wisatawan",
                        "D": "Memudahkan pemasangan elevator dan sistem utilitas"
                    },
                    "explanation": "Burj Khalifa menggunakan desain berbentuk Y yang menyempit ke atas (tapered profile) dengan sistem struktur inti penopang (buttressed core). Desain ini berfungsi untuk mengurangi gaya angin yang bekerja pada bangunan dengan cara \"mengacaukan\" pola angin (vortex shedding) sehingga tekanan angin tidak terkonsentrasi pada satu titik, melainkan tersebar sepanjang ketinggian bangunan. Dengan bagian bawah yang lebih lebar dan bagian atas yang ramping, beban dan gaya angin dapat didistribusikan secara efisien, membuat struktur lebih kuat dan aman.<br>Selain itu, Burj Khalifa dilengkapi dengan tingkat spiral yang berfungsi sebagai pemecah angin. Sistem inti beton yang diperkuat dengan tiga sayap besar memberikan kekakuan tinggi sehingga gedung mampu menahan angin hingga 250 km/jam dengan pergeseran puncak hanya sekitar 2 meter saat angin kencang."
                },
                "10": {
                    "materi": "Menara Pisa",
                    "question": "Salah satu upaya awal untuk mengoreksi kemiringan Menara Pisa adalah dengan menambah tanah atau material di sisi yang lebih rendah. Namun, cara ini justru memperburuk kemiringan menara. Apa alasan utama metode ini menjadi kontra-produktif?",
                    "prompt": "",
                    "correctAnswer": "A",
                    "options": {
                        "A": "Penambahan massa di sisi rendah menyebabkan tekanan tanah bertambah dan pondasi semakin turun",
                        "B": "Material yang ditambahkan tidak mampu menahan beban menara dalam jangka panjang",
                        "C": "Penambahan material mengganggu kestabilan struktur pondasi dan mempercepat kemiringan",
                        "D": "Upaya ini menyebabkan distribusi berat menara semakin tidak seimbang sehingga kemiringan bertambah"
                    },
                    "explanation": "Upaya awal untuk mengoreksi kemiringan Menara Pisa dengan menambah tanah atau material di sisi yang lebih rendah justru menjadi kontra-produktif. Alasan utamanya adalah penambahan massa di sisi rendah menyebabkan tekanan tanah bertambah dan pondasi semakin turun.<br>Saat tanah atau material ditambahkan di sisi Menara Pisa yang lebih rendah (sisi yang miring ke bawah), hal ini secara langsung meningkatkan beban atau massa pada area tersebut. Penambahan massa ini pada gilirannya menyebabkan peningkatan tekanan pada tanah di bawah pondasi Menara. Tanah di bawah Menara Pisa dikenal sebagai tanah yang lunak dan kompresibel. Ketika tekanan meningkat pada tanah seperti ini, ia akan semakin padat dan \"turun,\" menyebabkan pondasi di sisi tersebut semakin amblas. Akibatnya, kemiringan Menara justru bertambah parah."
                },
                "11": {
                    "materi": "Petra",
                    "question": "Popularitas Petra sebagai destinasi wisata global telah meningkatkan jumlah pengunjung secara drastis. Namun, peningkatan ini juga menimbulkan tantangan signifikan. Tantangan utama apakah yang dihadapi Petra sebagai konsekuensi dari popularitasnya?",
                    "prompt": "",
                    "correctAnswer": "D",
                    "options": {
                        "A": "Penurunan minat masyarakat lokal terhadap sejarah",
                        "B": "Kurangnya infrastruktur pariwisata yang memadai",
                        "C": "Potensi kehilangan status Warisan Dunia UNESCO",
                        "D": "Peningkatan erosi dan kerusakan fisik struktur kuno"
                    },
                    "explanation": "Popularitas Petra membawa manfaat ekonomi bagi Yordania, tetapi juga memberikan tekanan besar pada kelestarian fisiknya. Struktur batu pasir Petra sangat rentan terhadap erosi akibat angin, air, dan aktivitas wisatawan seperti sentuhan, gesekan alas kaki, dan polusi udara. Banjir bandang juga memperparah kerusakan.<br>Laporan dari UNESCO dan para ahli konservasi menyoroti urgensi pengelolaan hati-hati dan pembatasan jumlah pengunjung untuk melindungi situs ini dari kerusakan tak terkendali, menjadikan pelestarian fisik Petra sebagai tantangan utama dibandingkan isu lainnya."
                },
                "12": {
                    "materi": "Colosseum",
                    "question": "Colosseum dirancang untuk menampung puluhan ribu penonton dan dapat mengosongkan diri dalam waktu yang sangat singkat. Sistem arsitektur apa yang paling berkontribusi pada efisiensi manajemen kerumunan ini?",
                    "prompt": "",
                    "correctAnswer": "B",
                    "options": {
                        "A": "Desain arena yang miring, mengalirkan penonton keluar melalui satu gerbang utama",
                        "B": "Penggunaan 80 pintu masuk bernomor (vomitoria) dan jalur terpisah untuk aliran simultan",
                        "C": "Penonton diwajibkan untuk masuk dan keluar secara bergantian",
                        "D": "Tersedia kereta dorong untuk memindahkan penonton dengan cepat"
                    },
                    "explanation": "Colosseum menunjukkan kecanggihannya arsitektur Romawi dalam mengelola massa dengan sangat efisien. Salah satu inovasi utamanya adalah keberadaan 80 pintu masuk bernomor yang disebut vomitoria. Sistem ini memungkinkan penonton masuk dan keluar secara serentak melalui jalur yang sudah ditentukan, menghindari penumpukan dan mempercepat pergerakan. Desainnya yang berbentuk elips tidak hanya mendukung visibilitas dari semua sudut, tetapi juga memudahkan distribusi penonton ke seluruh area. Dengan perpaduan antara keindahan bentuk dan fungsi praktis, Colosseum menjadi bukti keunggulan Romawi dalam menyatukan estetika dan efisiensi dalam satu struktur megah."
                },
                "13": {
                    "materi": "Sphinx (Mesir)",
                    "question": "Dalam konteks kompleks piramida Giza, Sphinx sering dianggap memiliki peran pelindung. Jelaskan secara analitis mengapa Sphinx ditempatkan sebagai \"penjaga\" di lokasi tersebut, dan apa yang secara spesifik diyakini dilindungi oleh monumen kolosal ini?",
                    "prompt": "",
                    "correctAnswer": "A",
                    "options": {
                        "A": "Melindungi kompleks pemakaman dari gangguan spiritual dan menjaga kesucian ritual",
                        "B": "Menyimpan harta karun firaun yang paling berharga di dalam ruang rahasianya",
                        "C": "Mencegah banjir Sungai Nil agar tidak mencapai piramida",
                        "D": "Sebagai pos pengamatan untuk memantau pergerakan suku nomaden di gurun"
                    },
                    "explanation": "Sphinx Agung di Giza dengan tubuh singa dan kepala manusia, merupakan monumen simbolik yang secara tradisional diasosiasikan dengan kekuatan, kebijaksanaan, dan perlindungan spiritual. Dalam budaya Mesir Kuno, hewan buas seperti singa sering dianggap sebagai pelindung terhadap kekuatan jahat, sementara kepala manusia melambangkan intelektualitas dan kekuasaan.<br>Penempatan Sphinx tepat di depan kompleks piramida Khafre bukan kebetulan. Secara arsitektural dan simbolik, posisi ini mengindikasikan fungsi penjagaan terhadap makam-makam firaun, termasuk piramida dan kuil pemakamannya. Kepercayaan Mesir Kuno menyatakan bahwa dunia orang mati perlu dilindungi dari gangguan roh jahat, penyusup, dan pencuri makam. Oleh karena itu, Sphinx berperan sebagai \"penjaga sakral\" atas area suci tersebut."
                },
                "14": {
                    "materi": "Christ the Redeemer",
                    "question": "Patung Cristo Redentor di Rio de Janeiro mengalami perubahan desain dari rancangan awal yang menampilkan Yesus memegang salib dan bola dunia, lalu diubah menjadi pose tangan terbuka lebar. Mengapa perubahan desain tersebut dianggap mencerminkan pesan universal dari patung ini?",
                    "prompt": "",
                    "correctAnswer": "C",
                    "options": {
                        "A": "Desain awal terlalu kaku dan kurang menarik secara visual bagi wisatawan internasional",
                        "B": "Modifikasi desain tersebut lebih efisien dari segi penggunaan material dan proses konstruksi",
                        "C": "Tangan terbuka melambangkan sambutan dan perdamaian yang bersifat lebih universal",
                        "D": "Rancangan awal memiliki kemiripan berlebihan dengan patung-patung Kristus lainnya di dunia"
                    },
                    "explanation": "Perubahan desain Patung Kristus Penebus (Cristo Redentor) menjadi pose tangan terbuka lebar secara fundamental mencerminkan pesan universal karena gesture tangan terbuka melambangkan sambutan, perdamaian, dan penebusan yang bersifat inklusif bagi semua orang, melampaui batas-batas keagamaan spesifik. Ini menjadikannya simbol penerimaan dan harapan bagi dunia.<br>Analisis opsi lain:<ul style=\"margin-left: 10px; padding-left: 10px;\"><li>A & B (Salah): Alasan estetika atau efisiensi konstruksi tidak merepresentasikan makna universal yang mendalam dari perubahan desain.</li><li>D (Salah): Meskipun keunikan adalah aspeknya, motif utama perubahan adalah perluasan makna simbolis, bukan sekadar diferensiasi.</li></ul>"
                },
                "15": {
                    "materi": "Moai Statue",
                    "question": "Para ahli telah lama berupaya memecahkan misteri pemindahan patung Moai raksasa dari tambang Rano Raraku ke lokasi-lokasi ahu di seluruh Pulau Paskah. Salah satu teori yang menjelaskan hal ini adalah teknik \"berjalan\" Moai. Bagaimana masyarakat Rapa Nui kuno diduga memindahkan patung-patung ini dengan metode tersebut?",
                    "prompt": "",
                    "correctAnswer": "A",
                    "options": {
                        "A": "Patung-patung digoyangkan maju dalam posisi tegak menggunakan tali dan tenaga manusia",
                        "B": "Patung digulingkan secara horizontal di atas gelondongan kayu yang ditarik oleh banyak orang",
                        "C": "Moai diangkut melalui perairan menggunakan rakit besar yang terbuat dari batang pohon palem",
                        "D": "Menggunakan ramp tanah dan katrol sederhana untuk mengangkat patung secara bertahap"
                    },
                    "explanation": "Penelitian arkeolog Terry Hunt dan Carl Lipo menunjukkan bahwa patung Moai di Pulau Paskah dipindahkan dengan teknik \"berjalan\" menggunakan tali. Patung yang berdiri tegak digoyangkan maju mundur secara bergantian dari sisi ke sisi, dengan beberapa orang menarik tali di kedua sisi patung dan kelompok kecil di belakang yang menjaga keseimbangan dan mengarahkan gerakan. Teknik ini memungkinkan patung yang beratnya mencapai beberapa ton bergerak maju perlahan tanpa harus digulingkan atau diseret di atas kayu gelondongan yang rentan rusak. Metode ini juga didukung oleh tradisi lisan masyarakat Rapa Nui yang menyebut patung-patung itu \"berjalan\" (neke-neke), dan telah dibuktikan melalui eksperimen pemindahan replika patung seberat lima ton. Cara ini dinilai efisien dan ramah lingkungan, sesuai dengan kondisi Pulau Paskah yang minim sumber daya kayu."
                }
            },
            participants: {
                "raffizahrandhika": {
                    name: "Muhammad Raffi Zahrandhika",
                    answers: ["B", "0", "C", "0", "A", "D", "D", "0", "D", "0", "0", "0", "0", "0", "0"]
                },
                "testuser": {
                    name: "Muhammad Althaf",
                    answers: ["A", "B", "C", "D", "A", "B", "C", "D", "A", "B", "C", "D", "A", "B", "C"]
                }
            },
            weightData: [
                { no: 1, landmark: "Patung Liberty", a: "5%", b: "90%", c: "5%", d: "0%", key: "B", difficulty: "-2.25", initialWeight: "50", finalWeight: "44.11" },
                { no: 2, landmark: "Candi Borobudur", a: "59%", b: "18%", c: "18%", d: "5%", key: "A", difficulty: "-0.37", initialWeight: "79", finalWeight: "69.68" },
                { no: 3, landmark: "Taj Mahal", a: "35%", b: "38%", c: "27%", d: "0%", key: "C", difficulty: "1.00", initialWeight: "100", finalWeight: "88.23" },
                { no: 4, landmark: "Piramida Giza", a: "4%", b: "63%", c: "11%", d: "22%", key: "B", difficulty: "-0.53", initialWeight: "76", finalWeight: "67.47" },
                { no: 5, landmark: "Menara Eiffel", a: "80%", b: "8%", c: "12%", d: "0%", key: "A", difficulty: "-1.39", initialWeight: "63", finalWeight: "55.85" },
                { no: 6, landmark: "Akropolis Athena", a: "22%", b: "9%", c: "13%", d: "57%", key: "D", difficulty: "-0.26", initialWeight: "81", finalWeight: "71.11" },
                { no: 7, landmark: "Ka'bah", a: "13%", b: "13%", c: "48%", d: "26%", key: "C", difficulty: "0.09", initialWeight: "86", finalWeight: "75.85" },
                { no: 8, landmark: "Great Wall China", a: "11%", b: "16%", c: "74%", d: "0%", key: "C", difficulty: "-1.03", initialWeight: "69", finalWeight: "60.70" },
                { no: 9, landmark: "Burj Khalifa", a: "0%", b: "82%", c: "9%", d: "9%", key: "B", difficulty: "-1.50", initialWeight: "61", finalWeight: "54.26" },
                { no: 10, landmark: "Menara Pisa", a: "53%", b: "21%", c: "11%", d: "16%", key: "A", difficulty: "-0.11", initialWeight: "83", finalWeight: "73.24" },
                { no: 11, landmark: "Petra", a: "18%", b: "6%", c: "18%", d: "59%", key: "D", difficulty: "-0.36", initialWeight: "79", finalWeight: "69.83" },
                { no: 12, landmark: "Colosseum", a: "17%", b: "65%", c: "13%", d: "4%", key: "B", difficulty: "-0.63", initialWeight: "75", finalWeight: "66.14" },
                { no: 13, landmark: "Sphinx (Mesir)", a: "47%", b: "32%", c: "16%", d: "5%", key: "A", difficulty: "0.11", initialWeight: "86", finalWeight: "76.10" },
                { no: 14, landmark: "Christ the Redeemer", a: "5%", b: "14%", c: "76%", d: "5%", key: "C", difficulty: "-1.16", initialWeight: "67", finalWeight: "58.88" },
                { no: 15, landmark: "Moai Statue", a: "61%", b: "17%", c: "17%", d: "6%", key: "A", difficulty: "-0.45", initialWeight: "78", finalWeight: "68.54" }
            ]
        };

        /* Configuration for certificate rendering (can be adjusted) */
        const certificateConfig = {
            nameAlign: 'left', // 'center' or 'left'
            // Modes to compute left X position when left-aligned:
            // 'fixed' -> use nameLeftMargin (pixels)
            // 'factor' -> use width * nameLeftFactor (fraction of canvas width)
            // 'chars' -> use charOffset * name.length
            nameLeftMode: 'factor',
            nameLeftMargin: 140, // pixels from left when nameLeftMode === 'fixed'
            nameLeftFactor: 0.26, // fraction of canvas width when nameLeftMode === 'factor'
            charOffset: 12, // px per character when nameLeftMode === 'chars'
            eventName: 'R-QUEST Quiz', // default event name used in QR payload
            tzOffsetHours: 7 // timezone offset hours for QR timestamp (GMT+7)
        };

        // ===== FUNGSI BANTU =====
        function calculateScore(username) {
            const participant = quizData.participants[username];
            if (!participant) return 0;

            let totalScore = 0;
            const answers = participant.answers;

            for (let i = 0; i < answers.length; i++) {
                const questionNum = i + 1;
                const userAnswer = answers[i]?.toUpperCase();
                const question = quizData.questions[questionNum];
                const weightItem = quizData.weightData.find(w => w.no === questionNum);

                if (!userAnswer || userAnswer === "0" || !question || !weightItem) continue;

                const isCorrect = userAnswer === question.correctAnswer;
                if (isCorrect) {
                    totalScore += parseFloat(weightItem.finalWeight) || 0;
                }
            }
            return Math.round(totalScore);
        }

        function calculateAllRanks() {
            const participants = quizData.participants;
            const scoreList = [];

            for (const username in participants) {
                scoreList.push({
                    username,
                    score: calculateScore(username)
                });
            }

            scoreList.sort((a, b) => b.score - a.score);

            const ranks = {};
            const scores = {};

            let currentRank = 1;
            let lastScore = null;

            for (let i = 0; i < scoreList.length; i++) {
                const item = scoreList[i];
                scores[item.username] = item.score;

                if (item.score !== lastScore) {
                    currentRank = i + 1;
                    lastScore = item.score;
                }
                ranks[item.username] = currentRank;
            }

            return { scores, ranks };
        }

        // ===== STATE GLOBAL =====
        let globalScores = {};
        let globalRanks = {};

        // ===== LOCKED STATE FUNCTIONALITY =====
        function initializeLockedState() {
            const lockedModal = document.getElementById('lockedModal');
            const lockedBtn = document.getElementById('lockedBtn');
            const unlockedBtn = document.getElementById('unlockedBtn');
            const daysEl = document.getElementById('days');
            const hoursEl = document.getElementById('hours');
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');

            if (!lockedModal || !daysEl || !hoursEl || !minutesEl || !secondsEl) {
                console.error('Locked modal elements not found!');
                return;
            }

            // Set target date: 28 Januari 2026, 16:30 WIB (GMT+7)
            const targetDate = new Date('2026-01-05T12:00:00+07:00');

            let countdownInterval;

            // Function to update countdown
            function updateCountdown() {
                const now = new Date();
                const diff = targetDate - now;

                if (diff <= 0) {
                    // Time's up - unlock the results
                    unlockResults();
                    return;
                }

                // Calculate days, hours, minutes, seconds
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);

                // Update display
                daysEl.textContent = days.toString().padStart(2, '0');
                hoursEl.textContent = hours.toString().padStart(2, '0');
                minutesEl.textContent = minutes.toString().padStart(2, '0');
                secondsEl.textContent = seconds.toString().padStart(2, '0');
            }

            // Function to unlock results
            function unlockResults() {
                console.log('Hasil kuis telah dibuka!');

                // Hide locked modal
                lockedModal.style.display = 'none';

                // Show unlocked button and hide locked button
                if (lockedBtn) lockedBtn.classList.add('hidden');
                if (unlockedBtn) unlockedBtn.classList.remove('hidden');

                // Enable search functionality
                const searchBtn = document.getElementById('searchBtn');
                const usernameInput = document.getElementById('usernameInput');

                if (searchBtn) {
                    searchBtn.disabled = false;
                    searchBtn.style.opacity = '1';
                    searchBtn.style.cursor = 'pointer';
                    searchBtn.innerHTML = '<i class="fas fa-search"></i> View Results';
                }

                if (usernameInput) {
                    usernameInput.disabled = false;
                    usernameInput.placeholder = "Enter your username (e.g., raffizahrandhika)";
                    usernameInput.style.backgroundColor = '';
                }

                // Stop the countdown
                if (countdownInterval) {
                    clearInterval(countdownInterval);
                }

                // Show notification
                showUnlockNotification();
            }

            // Function to show unlock notification
            function showUnlockNotification() {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = 'unlock-notification';
                notification.innerHTML = `
            <div style="
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, var(--success) 0%, #2E7D32 100%);
                color: white;
                padding: 12px 16px;
                border-radius: var(--radius-md);
                box-shadow: var(--shadow-lg);
                z-index: 3000;
                display: flex;
                align-items: center;
                gap: 10px;
                animation: slideInRight 0.5s ease;
                max-width: 320px;
                font-size: 0.9rem;
            ">
                <i class="fas fa-check-circle" style="font-size: 1.1rem;"></i>
                <div>
                    <strong>Hasil Kuis Tersedia!</strong><br>
                    <span style="font-size: 0.8rem;">Sekarang Anda dapat melihat hasil dan sertifikat.</span>
                </div>
            </div>
        `;

                document.body.appendChild(notification);

                // Remove notification after 5 seconds
                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.5s ease forwards';
                    setTimeout(() => notification.remove(), 500);
                }, 5000);
            }

            // Add CSS animation for notification
            if (!document.querySelector('#unlock-animations')) {
                const style = document.createElement('style');
                style.id = 'unlock-animations';
                style.textContent = `
            @keyframes slideInRight {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOutRight {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
            
            .unlock-notification {
                pointer-events: none;
            }
        `;
                document.head.appendChild(style);
            }

            // Add click handler for unlocked button
            if (unlockedBtn) {
                unlockedBtn.addEventListener('click', () => {
                    lockedModal.style.display = 'none';
                });
            }

            // Check if target date has passed
            const now = new Date();

            if (now >= targetDate) {
                console.log('Tanggal target telah tercapai - membuka hasil kuis');
                unlockResults();
                lockedModal.style.display = 'none';
            } else {
                // Show locked modal and start countdown
                console.log('Hasil kuis masih terkunci - menampilkan modal');
                lockedModal.style.display = 'flex';

                // Disable search functionality initially
                const searchBtn = document.getElementById('searchBtn');
                const usernameInput = document.getElementById('usernameInput');

                if (searchBtn) {
                    searchBtn.disabled = true;
                    searchBtn.style.opacity = '0.5';
                    searchBtn.style.cursor = 'not-allowed';
                    searchBtn.innerHTML = '<i class="fas fa-clock"></i> Results Locked';
                }

                if (usernameInput) {
                    usernameInput.disabled = true;
                    usernameInput.placeholder = "Waiting for results to be available...";
                    usernameInput.style.backgroundColor = 'var(--gray-light)';
                }

                // Initial update
                updateCountdown();

                // Start countdown interval
                countdownInterval = setInterval(updateCountdown, 1000);

                // Store interval ID for cleanup
                window.lockedCountdownInterval = countdownInterval;
            }
        }

        // ===== FUNGSI UTAMA =====
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, initializing...');

            // Initialize locked state FIRST
            initializeLockedState();

            // Auto-fill username from URL parameters if present
            const urlParams = new URLSearchParams(window.location.search);
            const usernameFromURL = urlParams.get('username');
            if (usernameFromURL) {
                document.getElementById('usernameInput').value = usernameFromURL;
                // Auto-search setelah delay kecil
                setTimeout(() => {
                    if (document.getElementById('searchBtn') && !document.getElementById('searchBtn').disabled) {
                        searchUser();
                    }
                }, 800);
            }

            const rankData = calculateAllRanks();
            globalScores = rankData.scores;
            globalRanks = rankData.ranks;

            // DOM Elements
            const usernameInput = document.getElementById('usernameInput');
            const searchBtn = document.getElementById('searchBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const emptyState = document.getElementById('emptyState');
            const participantName = document.getElementById('participantName');
            const participantUsername = document.getElementById('participantUsername');
            const participantRank = document.getElementById('participantRank');
            const totalParticipants = document.getElementById('totalParticipants');
            const totalScore = document.getElementById('totalScore');
            const scoreProgress = document.getElementById('scoreProgress');
            const congratsMessage = document.getElementById('congratsMessage');
            const profileAvatar = document.getElementById('profileAvatar');
            const answersList = document.getElementById('answersList');
            const answerDetails = document.getElementById('answerDetails');
            const weightTable = document.getElementById('weightTable');
            const cognitiveAnalysis = document.getElementById('cognitiveAnalysis');
            const recommendations = document.getElementById('recommendations');
            const progressTracking = document.getElementById('progressTracking');
            const shareResultsBtn = document.getElementById('shareResultsBtn');
            const certificateNameInput = document.getElementById('certificateNameInput');
            let currentCertParticipantUsername = null;

            // Tab functionality
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    tabBtns.forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    btn.classList.add('active');
                    const tabId = btn.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });

            // Search functionality
            searchBtn.addEventListener('click', searchUser);
            usernameInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') searchUser();
            });

            // Disable share until user searches and results are shown
            if (shareResultsBtn) shareResultsBtn.disabled = true;

            function searchUser() {
                // Check if still locked (fail-safe)
                const searchBtn = document.getElementById('searchBtn');
                if (searchBtn && searchBtn.disabled) {
                    alert('Hasil kuis belum tersedia. Silakan tunggu hingga timer selesai.');
                    return;
                }

                const username = usernameInput.value.trim().toLowerCase();
                if (!username) {
                    alert('Please enter a username');
                    return;
                }

                const participant = quizData.participants[username];
                if (participant) {
                    resultsContainer.style.display = 'block';
                    emptyState.style.display = 'none';

                    const score = globalScores[username] || 0;
                    const rank = globalRanks[username] || 1;
                    const totalParts = Object.keys(quizData.participants).length;

                    participantName.textContent = participant.name;
                    participantUsername.textContent = username;
                    participantRank.textContent = rank;
                    totalParticipants.textContent = totalParts;
                    totalScore.textContent = score;

                    const progressPercent = (score / 1000) * 100;
                    scoreProgress.style.width = `${Math.min(100, progressPercent)}%`;

                    const initials = participant.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    profileAvatar.textContent = initials.substring(0, 2);

                    updateCongratsMessage(score);

                    displayAnswers(participant, username);
                    displayAnswerDetails(participant, username);
                    displayWeightTable();
                    updateAnalysis(participant, username, score, rank);

                    if (shareResultsBtn) shareResultsBtn.disabled = false;

                    resultsContainer.scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('Username not found. Please try again.');
                }
            }

            function renderCertificateCanvas(name) {
                const canvas = document.getElementById('certificatePreview');
                const ctx = canvas.getContext('2d');
                const width = 2000;
                const height = 1414;
                canvas.width = width;
                canvas.height = height;

                const img = new Image();
                img.crossOrigin = "anonymous";
                img.src = 'https://res.cloudinary.com/dy6sxsb26/image/upload/v1767509996/Cerificate-Quiz_zdbtz9.png';

                img.onload = function () {
                    ctx.drawImage(img, 0, 0, width, height);

                    const drawName = function () {
                        ctx.font = '400 120px MonteCarlo, cursive';
                        ctx.fillStyle = '#501711';
                        ctx.textBaseline = 'middle';
                        const yPos = height * 0.45;
                        let xPos = width / 2;
                        if (typeof certificateConfig !== 'undefined' && certificateConfig.nameAlign === 'left') {
                            ctx.textAlign = 'left';
                            // Allow different computation methods for left margin
                            if (certificateConfig.nameLeftMode === 'factor') {
                                xPos = Math.round(width * (certificateConfig.nameLeftFactor || 0.24));
                            } else if (certificateConfig.nameLeftMode === 'chars') {
                                const chars = Math.max(1, name.length);
                                xPos = Math.round((certificateConfig.charOffset || 12) * chars);
                            } else {
                                xPos = certificateConfig.nameLeftMargin || 140;
                            }
                        } else {
                            ctx.textAlign = 'center';
                            xPos = width / 2;
                        }

                        ctx.fillText(name, xPos, yPos);
                        ctx.shadowColor = 'rgba(0,0,0,0.1)';
                        ctx.shadowBlur = 2;
                        ctx.fillText(name, xPos, yPos);
                        ctx.shadowBlur = 0;
                    };

                    if (document.fonts && document.fonts.load) {
                        document.fonts.load('50px MonteCarlo').then(drawName).catch(drawName);
                    } else {
                        drawName();
                    }

                    // After name is drawn, also render QR and date
                    const drawExtras = function () {
                        try {
                            const now = new Date();
                            certificateConfig.lastGeneratedAt = now;
                            const dateStr = now.toLocaleDateString('id-ID', { day: '2-digit', month: 'short', year: 'numeric' });

                            // Build timestamp in GMT+X (certificateConfig.tzOffsetHours) in 24-hour format
                            const tzHours = certificateConfig.tzOffsetHours || 7;
                            const utcMs = now.getTime() + (now.getTimezoneOffset() * 60000);
                            const tzDate = new Date(utcMs + (tzHours * 3600000));
                            const pad = (n) => n.toString().padStart(2, '0');
                            const formattedTimestamp = `${tzDate.getFullYear()}-${pad(tzDate.getMonth() + 1)}-${pad(tzDate.getDate())} ${pad(tzDate.getHours())}:${pad(tzDate.getMinutes())}:${pad(tzDate.getSeconds())}`;

                            // QR payload: Link ke halaman ini dengan username otomatis terisi
                            const currentUrl = window.location.href.split('?')[0]; // Hapus query parameters lama
                            const username = currentCertParticipantUsername || 'raffizahrandhika'; // Default fallback
                            const qrLink = `${currentUrl}?username=${encodeURIComponent(username)}&from_cert=true&t=${Date.now()}`;
                            const verificationText = qrLink;

                            const qrSize = Math.round(width * 0.08); // ~8% of canvas width
                            const margin = Math.round(width * 0.03);
                            const xQR = width - margin - qrSize;
                            const yQR = height - margin - qrSize;

                            // Generate QR data URL (prefer Qrious if available, fallback to Google Chart API)
                            let qrDataUrl;
                            if (window.QRious) {
                                try {
                                    const qr = new QRious({ value: verificationText, size: qrSize, level: 'M' });
                                    qrDataUrl = qr.toDataURL();
                                } catch (err) {
                                    qrDataUrl = 'https://chart.googleapis.com/chart?chs=' + qrSize + 'x' + qrSize + '&cht=qr&chl=' + encodeURIComponent(verificationText);
                                }
                            } else {
                                qrDataUrl = 'https://chart.googleapis.com/chart?chs=' + qrSize + 'x' + qrSize + '&cht=qr&chl=' + encodeURIComponent(verificationText);
                            }

                            const qrImg = new Image();
                            qrImg.crossOrigin = 'anonymous';
                            qrImg.src = qrDataUrl;
                            qrImg.onload = function () {
                                ctx.drawImage(qrImg, xQR, yQR, qrSize, qrSize);

                                // Draw small date text above the QR
                                const dateX = xQR + Math.round(qrSize / 2);
                                const dateY = yQR - Math.round(qrSize * 0.12);
                                ctx.font = Math.round(qrSize * 0.16) + 'px Inter, sans-serif';
                                ctx.fillStyle = '#501711';
                                ctx.textAlign = 'center';
                                ctx.textBaseline = 'bottom';
                                ctx.fillText(dateStr, dateX, dateY);
                            };
                        } catch (e) {
                            console.error('Error drawing extras (QR/date):', e);
                        }
                    };
                    // call extras after a short timeout to ensure name rendering completed
                    setTimeout(drawExtras, 80);
                };

                img.onerror = function () {
                    console.error('Gagal memuat gambar sertifikat');
                    ctx.fillStyle = '#000';
                    ctx.font = '20px sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('Gagal memuat sertifikat', width / 2, height / 2);
                };
            }

            function updateCongratsMessage(score) {
                let message = '';
                let emoji = '';
                if (score >= 900) {
                    message = "Outstanding performance! You've demonstrated exceptional knowledge of world landmarks. Your score places you in the top tier of participants.";
                    emoji = "";
                } else if (score >= 700) {
                    message = "Excellent work! You have a strong understanding of global landmarks and their historical significance.";
                    emoji = "";
                } else if (score >= 500) {
                    message = "Good job! You've shown solid knowledge with room for further exploration of world wonders.";
                    emoji = "";
                } else if (score >= 300) {
                    message = "Fair attempt! You have basic knowledge but could benefit from further study of world landmarks.";
                    emoji = "";
                } else {
                    message = "Keep learning! Every expert was once a beginner. Use these results to identify areas for improvement.";
                    emoji = "";
                }
                congratsMessage.innerHTML = `<strong>${emoji} ${message}</strong>`;
            }

            function displayAnswers(participant, username) {
                answersList.innerHTML = '';
                for (let i = 0; i < participant.answers.length; i++) {
                    const questionNum = i + 1;
                    const questionData = quizData.questions[questionNum] || {
                        materi: `Question ${questionNum}`,
                        question: `Question content for question ${questionNum}`,
                        options: { A: "Option A", B: "Option B", C: "Option C", D: "Option D" },
                        correctAnswer: "A",
                        explanation: "Explanation not available"
                    };

                    const userAnswer = (participant.answers[i] || "0").toUpperCase();
                    const isAnswered = userAnswer !== "0";
                    const correctAnswer = questionData.correctAnswer;
                    const isCorrect = isAnswered && userAnswer === correctAnswer;

                    let statusClass, statusText;
                    if (!isAnswered) {
                        statusClass = 'status-unanswered';
                        statusText = 'Not Answered';
                    } else if (isCorrect) {
                        statusClass = 'status-correct';
                        statusText = 'Correct';
                    } else {
                        statusClass = 'status-incorrect';
                        statusText = 'Incorrect';
                    }

                    const answerCard = document.createElement('div');
                    answerCard.className = 'answer-card';
                    answerCard.innerHTML = `
            <div class="answer-header">
                <div class="answer-number">${questionNum}. ${questionData.materi}</div>
                <span class="${statusClass}">${statusText}</span>
            </div>
            <div class="answer-question">${questionData.question}</div>
            <div class="answer-details">
                <div class="user-answer-box">
                    <div class="answer-box-label">Your Answer</div>
                    <div class="answer-box-content">
                        ${isAnswered
                            ? `${userAnswer}. ${questionData.options[userAnswer] || 'Unknown option'}`
                            : 'Not answered'}
                    </div>
                </div>
                <div class="correct-answer-box">
                    <div class="answer-box-label">Correct Answer</div>
                    <div class="answer-box-content">
                        ${correctAnswer}. ${questionData.options[correctAnswer]}
                    </div>
                </div>
            </div>
            <div class="explanation-box">
                <div class="explanation-label">
                    <i class="fas fa-lightbulb"></i> Explanation
                </div>
                <div class="explanation-content">
                    ${questionData.explanation}
                </div>
            </div>
        `;
                    answersList.appendChild(answerCard);
                }
            }

            function displayAnswerDetails(participant, username) {
                answerDetails.innerHTML = '';
                const score = globalScores[username] || 0;
                let cumulative = 0;

                for (let i = 0; i < participant.answers.length; i++) {
                    const questionNum = i + 1;
                    const questionData = quizData.questions[questionNum] || { materi: `Question ${questionNum}` };
                    const userAnswer = (participant.answers[i] || "0").toUpperCase();
                    const weightItem = quizData.weightData.find(w => w.no === questionNum);
                    const isAnswered = userAnswer !== "0";
                    const isCorrect = isAnswered && userAnswer === questionData.correctAnswer;

                    const pointsEarned = isCorrect && weightItem ? parseFloat(weightItem.finalWeight) : 0;
                    cumulative += pointsEarned;

                    const row = document.createElement('tr');
                    let statusCell, resultCell;

                    if (!isAnswered) {
                        statusCell = '<span class="status-unanswered">Not Answered</span>';
                        resultCell = '-';
                    } else if (isCorrect) {
                        statusCell = '<span class="status-correct">Answered</span>';
                        resultCell = '<span class="status-correct">Correct</span>';
                    } else {
                        statusCell = '<span class="status-incorrect">Answered</span>';
                        resultCell = '<span class="status-incorrect">Incorrect</span>';
                    }

                    row.innerHTML = `
            <td>${questionNum}</td>
            <td>${questionData.materi}</td>
            <td>${statusCell}</td>
            <td>${resultCell}</td>
            <td><strong>${Math.round(pointsEarned)}</strong></td>
        `;
                    answerDetails.appendChild(row);
                }
            }

            function displayWeightTable() {
                weightTable.innerHTML = '';
                quizData.weightData.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
            <td>${item.no}</td>
            <td>${item.landmark}</td>
            <td>${item.a}</td>
            <td>${item.b}</td>
            <td>${item.c}</td>
            <td>${item.d}</td>
            <td><strong>${item.key}</strong></td>
            <td>${item.difficulty}</td>
            <td>${item.initialWeight}</td>
            <td><strong>${item.finalWeight}</strong></td>
        `;
                    weightTable.appendChild(row);
                });
            }

            function updateAnalysis(participant, username, score, rank) {
                const totalQuestions = participant.answers.length;
                const answered = participant.answers.filter(a => a !== "0").length;
                const correctCount = participant.answers.filter((ans, i) => {
                    const userAns = ans.toUpperCase();
                    return userAns !== "0" && userAns === quizData.questions[i + 1]?.correctAnswer;
                }).length;
                const accuracy = answered > 0 ? Math.round((correctCount / answered) * 100) : 0;
                const totalParts = Object.keys(quizData.participants).length;
                const percentile = Math.round(((totalParts - rank + 1) / totalParts) * 100);

                cognitiveAnalysis.innerHTML = `
        <p>You answered <strong>${answered}/${totalQuestions}</strong> questions (<strong>${Math.round((answered / totalQuestions) * 100)}%</strong> attempt rate).</p>
        <p>Your accuracy was <strong>${accuracy}%</strong> on attempted questions.</p>
        <p>Based on IRT scoring, your performance indicates <strong>${accuracy >= 80 ? 'strong' : accuracy >= 60 ? 'moderate' : 'developing'}</strong> understanding of the subject matter.</p>
    `;

                recommendations.innerHTML = `
        <p><strong>Recommended focus areas:</strong></p>
        <ul style="padding-left: 20px; margin-top: 10px;">
            ${accuracy < 70 ? '<li>Review landmark historical contexts</li>' : ''}
            ${accuracy < 80 ? '<li>Study architectural significance</li>' : ''}
            <li>Explore cultural impacts of world wonders</li>
            <li>Practice with more IRT-based assessments</li>
        </ul>
    `;

                progressTracking.innerHTML = `
        <p>Your score of <strong>${score}/1000</strong> places you in the <strong>top ${percentile}%</strong> of participants.</p>
        <p>Compared to average performance: <strong>${score > 500 ? 'Above' : 'Below'} average</strong></p>
        <p>Next milestone: <strong>${1000 - score} points</strong> to perfect score</p>
    `;
            }

            // Certificate Modal functionality
            const certificateModal = document.getElementById('certificateModal');
            const closeCertificateModal = document.getElementById('closeCertificateModal');
            const downloadCertificateBtn = document.getElementById('downloadCertificateBtn');
            const confirmDownloadBtn = document.getElementById('confirmDownloadBtn');

            downloadCertificateBtn.addEventListener('click', () => {
                const username = usernameInput.value.trim().toLowerCase();
                const participant = quizData.participants[username];
                if (!participant) {
                    alert('Please search for your username first');
                    return;
                }
                // set current user for modal and prefill custom name input
                currentCertParticipantUsername = username;
                if (certificateNameInput) certificateNameInput.value = participant.name || '';
                renderCertificateCanvas(certificateNameInput && certificateNameInput.value.trim() ? certificateNameInput.value.trim() : participant.name);
                certificateModal.style.display = 'flex';
            });

            closeCertificateModal.addEventListener('click', () => {
                certificateModal.style.display = 'none';
            });

            // re-render certificate preview when user edits the custom name
            if (certificateNameInput) {
                certificateNameInput.addEventListener('input', () => {
                    const nameVal = certificateNameInput.value.trim();
                    // if a participant is selected, use participant's name as fallback
                    const fallback = (currentCertParticipantUsername && quizData.participants[currentCertParticipantUsername]) ? quizData.participants[currentCertParticipantUsername].name : '';
                    renderCertificateCanvas(nameVal || fallback);
                });
            }

            confirmDownloadBtn.addEventListener('click', () => {
                const canvas = document.getElementById('certificatePreview');
                if (!canvas || !canvas.toBlob) {
                    alert('Canvas not supported in your browser for download.');
                    return;
                }

                const username = usernameInput.value.trim().toLowerCase();
                const participant = quizData.participants[username];
                if (!participant) {
                    alert('Peserta tidak ditemukan. Silakan cari username Anda terlebih dahulu.');
                    return;
                }

                // prefer custom name from input if provided
                const customName = (certificateNameInput && certificateNameInput.value.trim()) ? certificateNameInput.value.trim() : null;
                const name = customName || participant.name;

                canvas.toBlob(function (blob) {
                    const link = document.createElement('a');
                    link.download = `R-QUEST_Certificate_${name.replace(/\s+/g, '_')}.png`;
                    link.href = URL.createObjectURL(blob);
                    link.click();
                    URL.revokeObjectURL(link.href);
                }, 'image/png');
            });

            window.addEventListener('click', (e) => {
                if (e.target === certificateModal) certificateModal.style.display = 'none';
            });

            // Feedback form submission
            document.getElementById('feedbackForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const message = document.getElementById('feedbackMessage').value;
                if (!message.trim()) {
                    alert('Please enter your feedback');
                    return;
                }
                console.log('Feedback submitted');
                alert('Thank you for your feedback!');
                this.reset();

                // Reset anonymous checkbox
                const anonymousCheckbox = document.getElementById('anonymousCheckbox');
                const feedbackNameInput = document.getElementById('feedbackName');
                anonymousCheckbox.checked = false;
                feedbackNameInput.value = '';
                feedbackNameInput.disabled = false;
            });

            // Anonymous checkbox functionality
            const anonymousCheckbox = document.getElementById('anonymousCheckbox');
            const feedbackNameInput = document.getElementById('feedbackName');
            anonymousCheckbox.addEventListener('change', function () {
                if (this.checked) {
                    feedbackNameInput.value = 'Anonymous';
                    feedbackNameInput.disabled = true;
                    feedbackNameInput.style.backgroundColor = '#f8f5f2';
                    feedbackNameInput.style.color = '#8B7D6B';
                } else {
                    feedbackNameInput.value = '';
                    feedbackNameInput.disabled = false;
                    feedbackNameInput.style.backgroundColor = '';
                    feedbackNameInput.style.color = '';
                }
            });

            // Button handlers
            document.getElementById('downloadResultsBtn').addEventListener('click', () => {
                window.print();
            });

            if (shareResultsBtn) {
                shareResultsBtn.addEventListener('click', () => {
                    const username = usernameInput.value.trim().toLowerCase();
                    if (!username) {
                        alert('Please search for your username first before sharing results.');
                        return;
                    }

                    if (!navigator.share) {
                        alert('Sharing is not available: the Web Share API requires a secure context (HTTPS) and a supported browser. Try opening this page via HTTPS or use a compatible mobile browser.');
                        return;
                    }

                    const score = globalScores[username] || 0;
                    navigator.share({
                        title: 'My Quiz Results',
                        text: `I scored ${score}/1000 on the Wonders of Earth Quiz!`,
                        url: window.location.href
                    }).catch(err => console.log('Share failed:', err));
                });
            }

            // Awal: tampilkan weight table
            displayWeightTable();
        });
    </script>
</body>

</html>
